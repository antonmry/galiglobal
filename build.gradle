buildscript {
  repositories {
      mavenLocal()
      mavenCentral()   
      jcenter()
  }

  dependencies { 
      classpath 'me.champeau.gradle:jbake-gradle-plugin:0.2'
      classpath 'org.codehaus.groovy:groovy-all:2.3.0'
      classpath 'org.pegdown:pegdown:1.4.2'
      classpath 'org.ajoberstar:grgit:1.1.0'
  }
}

apply plugin: 'me.champeau.jbake'

jbake {
   input = file('src/jbake')
   output = file('build/jbake')
   clearCache = true
   configuration['render.tag'] = 'true'
}

ext.repo = org.ajoberstar.grgit.Grgit.open(
        project.file('build/jbake'),
        new org.ajoberstar.grgit.Credentials('antonmry', System.getenv('GH_TOKEN')))

task publish << {
    println "testing"
    println "Variable "+ System.getenv('TRAVIS_COMMIT_DESCRIPTION')
    repo.add(patterns: ['.'])
    repo.commit(message: System.getenv('TRAVIS_COMMIT_DESCRIPTION'), amend: true)
    repo.push(force: true);
}
